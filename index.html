<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://unpkg.com/gif-frames/dist/gif-frames.js"></script>

    <script src="loadimg.js" defer></script>
    <script src="img.js" defer></script>
    <script src="anim.js" defer></script>

    <script>
        function downloadCode() {

            const code = document.getElementById('pycode').innerHTML;
            if (code == '') return;

            const blob = new Blob([code]);
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'plingo.py';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

        }

        let imgurl;
    </script>

    <style>
        button {
            border: 2px solid lightblue;
            border-radius: 15px;
            background-color: #222;
            color: white;
            padding: 10px;

            transition: 300ms ease-in-out;
        }

        button:hover {
            background-color: #777;
        }
    </style>

    <title>Lights Image Loader</title>
</head>
<body>
    
    <h1>Do you like making lights animation for the robot?</h1>
    <h1>Sure you do! Now it'll be even easier</h1>

    <canvas id="kansas" style="display: none;"></canvas>

    <input type="file" id="imginput" accept=".png, .gif" onchange="loadImage(event)">

    <img src="./insertimagehere.png" style="width: 500px; height: 500px; image-rendering: pixelated;">

    <button onclick="exportCode()">Get Py Code !!!</button>

    <label for="animationclass">Use AnimationClass?</label>
    <input type="checkbox" name="animationclass" id="animationclass">

    <div style="position: relative; background-color: #222; border: 2px solid lightblue; border-radius: 15px; padding: 10px; color: white;">
        <pre id="pycode" style="text-wrap-mode: wrap;"></pre>

        <button id="downloadbutton" style="display: none; position: absolute; right: 10px; bottom: 10px;" onclick="downloadCode()">Download Code</button>
    </div>

    <script defer>
        async function exportCode() {
            try {
                if (imgurl == '') return;

                const fileinput = document.querySelector('input#imginput');
                const isFile = fileinput && fileinput.files && fileinput.files[0];
                
                if (!isFile) {
                    alert('Somehow no file loaded?');
                    return;
                }
                
                const file = fileinput.files[0];
                console.log(file);

                if (file.type.includes('gif')) await getCodeFromGif(imgurl);
                else await loadFromCanvas();

                URL.revokeObjectURL(imgurl);
                imgurl = '';

                document.querySelector('button#downloadbutton').style.display = 'block';
            }
            catch (err) {
                console.error(err.message);
            }
        }
    </script>

</body>
</html>